# 3D 演示平台触屏与响应式统一设计

日期：2026-02-26  
状态：已确认（用户已选：滚动策略1、手势等级3、接入模式1）

## 1. 背景与目标

当前项目已完成“导航页 -> 各演示页”的拆分，但后续会持续新增页面。为避免重复实现与交互不一致，本设计定义一套统一的平台能力，让所有现有与未来演示页面默认具备：

1. 跨设备响应式布局（桌面显示器、平板、手机）
2. 触屏优先且与鼠标兼容的交互逻辑
3. 场景级动画与交互解耦，支持低成本扩展
4. 导航统一入口，避免课堂演示中跨页干扰

本设计面向“平台能力”，不改动具体物理模型公式。

## 2. 已确认决策

1. 滚动策略：页面保持纵向滚动，手势仅在 3D 视图区域内生效。  
2. 手势等级：采用增强手势包（单指旋转、双指缩放/平移、双击重置、三指模式切换）。  
3. 新页面接入：默认自动接入统一 Shell（低配置、低重复）。

## 3. 架构边界与约束

采用“导航层”和“演示层”严格解耦：

1. `NavigationShell` 只负责目录展示、分组与跳转。  
2. `DemoShell` 只负责演示页通用骨架：响应式布局、触控容器、返回导航、状态恢复。  
3. `SceneModule` 只负责场景业务（渲染与控制逻辑），禁止跨场景依赖。

强制约束如下：

1. 单入口：用户必须从导航页进入演示页。  
2. 三档断点：`>=1200`（桌面）、`768-1199`（平板）、`<768`（手机）。  
3. 手势唯一入口：场景不得直接监听原始 `touchstart/touchmove`，必须通过统一交互内核。  
4. 输入统一：鼠标和触屏统一走 Pointer Events 抽象。  
5. 可扩展：新增演示只需注册元数据并实现标准接口，即可继承通用能力。

## 4. 组件分层与数据流

### 4.1 分层

1. App/Route 层：`NavigationPage` 与各 `DemoPage` 路由。  
2. Shell 层：`NavigationShell`、`DemoShell`、`ResponsiveScaffold`。  
3. Interaction 层：`TouchInteractionKernel`、`GestureMapper`。  
4. Scene 层：`CyclotronScene`、`OerstedScene`、`OscilloscopeScene` 等。

### 4.2 标准接口

新增统一 `SceneModule` 契约：

1. `render(): ReactNode`  
2. `controls(): ReactNode`  
3. `touchProfile(): TouchProfile`  
4. `reset(): void`

### 4.3 数据流

`PointerEvent -> TouchInteractionKernel -> GestureMapper -> ActionBus -> SceneStore -> SceneRenderer/UI`

约定：

1. `ActionBus` 只传递语义动作（如 `camera.rotate`），不暴露“几指”细节到场景层。  
2. 场景层只消费动作与状态，避免与硬件事件耦合。  
3. 手势规则变更仅影响 Interaction 层，不影响场景业务实现。

## 5. 触屏操作交互规范（全站统一）

### 5.1 核心手势映射

1. 单指拖动：旋转视角  
2. 双指捏合：缩放  
3. 双指同向拖动：平移  
4. 双击：重置视角/场景局部状态  
5. 三指点按：切换交互模式（例如“观察模式/操作模式”）

### 5.2 手势边界

1. 仅当事件源在 `InteractiveCanvas` 内时触发场景手势。  
2. 控件区（滑块、输入框、按钮）优先保证原生触控行为。  
3. 画布外保持自然页面滚动，防止“全页被手势劫持”。

### 5.3 触控可用性基线

1. 触控目标最小尺寸：`44x44`  
2. 动态反馈：模式切换与重置需有轻量视觉提示  
3. 误触控制：双击判定窗口、手势去抖与限幅  
4. 降级策略：不支持多指时保留单指旋转 + 显式重置按钮

## 6. 响应式布局规范

### 6.1 桌面（>=1200）

1. 左侧 3D/可视区 + 右侧控制面板双栏布局  
2. 导航信息、公式与参数可并排显示

### 6.2 平板（768-1199）

1. 上下分区：画布优先、控制面板折叠或抽屉化  
2. 常用动作固定在底部工具条

### 6.3 手机（<768）

1. 单列流式布局  
2. 画布高度自适应（保持可操作区域）  
3. 控制项分组折叠，保留核心参数快捷入口

### 6.4 统一尺寸令牌

所有尺寸、间距、圆角、阴影、层级、动画时长统一由 design tokens 驱动，禁止散落硬编码。

## 7. 错误处理与容错

三层容错机制：

1. Interaction 层：异常触控数据（NaN、突变、多指状态错乱）直接丢弃并上报轻量日志。  
2. Scene 层：参数更新先过数值守卫，超界回退最近合法值；`reset` 必须可重入。  
3. Shell 层：场景异常时展示降级卡片（重试 + 返回导航），避免课堂演示中断。

## 8. 测试策略与验收门槛

### 8.1 测试分层

1. 单元测试：`GestureMapper` 手势到动作映射  
2. 组件测试：`ResponsiveScaffold` 在三档断点布局表现  
3. 交互回归：触屏脚本验证核心链路（进入演示、手势操作、返回导航）

### 8.2 新增演示准入门槛

1. 必须实现 `touchProfile` 并声明手势能力矩阵。  
2. 必须通过至少 1 条断点测试 + 1 条触屏回归。  
3. 禁止绕过统一交互内核直接绑 `touch*` 事件。  
4. 导航元数据必须完整（名称、摘要、标签）。

### 8.3 验收清单

1. 三类设备均可完成“进入演示 -> 调参 -> 手势操作 -> 返回导航”。  
2. 控件可触达、可操作且无明显误触。  
3. 画布手势不影响页面正常滚动。  
4. 任一演示异常不影响导航页与其他演示访问。

## 9. 落地顺序建议

1. 第一步：抽出 `TouchInteractionKernel` 与 `GestureMapper` 并替换现有零散手势逻辑。  
2. 第二步：落地 `ResponsiveScaffold` 与统一断点令牌。  
3. 第三步：为每个现有演示补齐 `touchProfile` 与准入测试。  
4. 第四步：新增演示按 `SceneModule` 模板接入，默认继承全部平台能力。

